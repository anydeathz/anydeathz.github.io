<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Code Snippets</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better code display */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f6;
            color: #333;
        }
        pre {
            background-color: #2d2d2d; /* Dark background for code */
            color: #f8f8f2; /* Light text for code */
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto; /* Enable horizontal scrolling for long lines */
            font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        code {
            display: block; /* Ensures code block takes full width */
        }
        h2 {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body class="p-4 sm:p-8 md:p-12">
    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-lg shadow-xl">
        <h1 class="text-3xl sm:text-4xl font-bold text-center mb-8 text-gray-800">
            Data Analysis Code Snippets
        </h1>

        <!-- RFM Analysis Section -->
        <div class="mb-10">
            <h2 class="text-2xl sm:text-3xl font-semibold text-blue-700 mb-4 rounded-md p-2 bg-blue-50">
                RFM Analysis Visualizations
            </h2>
            <p class="text-gray-700 mb-4 leading-relaxed">
                This section contains Python code using <code>matplotlib</code> and <code>seaborn</code> to visualize the distributions and relationships of Recency, Frequency, and Monetary values derived from an RFM analysis. It also includes code for identifying top customers and correlation.
            </p>
            <pre><code>
import matplotlib.pyplot as plt
import seaborn as sns

# 1. Distribution of Recency
sns.histplot(df_rfm['Recency'], bins=30, kde=True, color='skyblue')
plt.title('Recency Distribution')
plt.xlabel('Days Since Last Purchase')
plt.ylabel('Number of Customers')
plt.show()

# 2. Distribution of Frequency
sns.histplot(df_rfm['Frequency'], bins=30, kde=True, color='lightgreen')
plt.title('Frequency Distribution')
plt.xlabel('Number of Purchases')
plt.ylabel('Number of Customers')
plt.show()

# 3. Distribution of Monetary
sns.histplot(df_rfm['Monetary'], bins=30, kde=True, color='salmon')
plt.title('Monetary Distribution')
plt.xlabel('Total Spend')
plt.ylabel('Number of Customers')
plt.show()

# 4. Recency vs Frequency Scatter
sns.scatterplot(data=df_rfm, x='Recency', y='Frequency', alpha=0.6)
plt.title('Recency vs Frequency')
plt.show()

# 5. Frequency vs Monetary Scatter
sns.scatterplot(data=df_rfm, x='Frequency', y='Monetary', alpha=0.6)
plt.title('Frequency vs Monetary')
plt.show()

# 6. Recency vs Monetary Scatter
sns.scatterplot(data=df_rfm, x='Recency', y='Monetary', alpha=0.6)
plt.title('Recency vs Monetary')
plt.show()

# 7. Boxplot of Monetary grouped by Frequency bins
df_rfm['FrequencyBin'] = pd.qcut(df_rfm['Frequency'], q=4, labels=['Low', 'Mid-Low', 'Mid-High', 'High'])
sns.boxplot(x='FrequencyBin', y='Monetary', data=df_rfm)
plt.title('Monetary Value by Frequency Group')
plt.show()

# 8. Countplot of Recency bins
df_rfm['RecencyBin'] = pd.qcut(df_rfm['Recency'], q=4, labels=['Recent', 'Mid-Recent', 'Mid-Old', 'Old'])
sns.countplot(x='RecencyBin', data=df_rfm)
plt.title('Customer Count by Recency Group')
plt.show()

# 9. Pareto - Top customers by monetary
top_customers = df_rfm.sort_values(by='Monetary', ascending=False).head(10)
sns.barplot(x='CustomerID', y='Monetary', data=top_customers, palette='magma')
plt.title('Top 10 Customers by Monetary Value')
plt.xticks(rotation=45)
plt.show()

# 10. Correlation Heatmap
sns.heatmap(df_rfm[['Recency', 'Frequency', 'Monetary']].corr(), annot=True, cmap='coolwarm')
plt.title('RFM Correlation Heatmap')
plt.show()
            </code></pre>
        </div>

        <!-- Sales Trend Analysis Section -->
        <div>
            <h2 class="text-2xl sm:text-3xl font-semibold text-green-700 mb-4 rounded-md p-2 bg-green-50">
                Sales Trend and Product Analysis
            </h2>
            <p class="text-gray-700 mb-4 leading-relaxed">
                This section presents Python code for analyzing various aspects of sales data, including monthly trends, top-selling products, customer spending, order value distribution, and sales by hour/day of the week. It also includes a check for returned products.
            </p>
            <pre><code>
# Convert InvoiceDate to datetime if not already
df['InvoiceDate'] = pd.to_datetime(df['InvoiceDate'])

# 1. Monthly Sales Trend
df['Month'] = df['InvoiceDate'].dt.to_period('M').astype(str)
monthly_sales = df.groupby('Month')['TotalPrice'].sum().reset_index()
sns.lineplot(data=monthly_sales, x='Month', y='TotalPrice')
plt.xticks(rotation=45)
plt.title('Monthly Sales Trend')
plt.ylabel('Total Sales')
plt.show()

# 2. Top-Selling Products by Quantity
top_products = df.groupby('Description')['Quantity'].sum().sort_values(ascending=False).head(10)
sns.barplot(y=top_products.index, x=top_products.values, palette='viridis')
plt.title('Top 10 Best-Selling Products')
plt.xlabel('Quantity Sold')
plt.ylabel('Product')
plt.show()

# 3. Top Customers by Monetary Value
top_customers = df.groupby('CustomerID')['TotalPrice'].sum().sort_values(ascending=False).head(10)
sns.barplot(x=top_customers.index.astype(str), y=top_customers.values, palette='magma')
plt.title('Top 10 Customers by Spend')
plt.ylabel('Total Spend')
plt.xlabel('Customer ID')
plt.show()

# 4. Order Value Distribution
sns.histplot(df['TotalPrice'], bins=50, kde=True, color='skyblue')
plt.title('Distribution of Order Values')
plt.xlabel('Total Price')
plt.ylabel('Frequency')
plt.xlim(0, df['TotalPrice'].quantile(0.99))   # Exclude outliers
plt.show()

# 5. Sales by Hour of Day
df['Hour'] = df['InvoiceDate'].dt.hour
hourly_sales = df.groupby('Hour')['TotalPrice'].sum().reset_index()
sns.lineplot(data=hourly_sales, x='Hour', y='TotalPrice')
plt.title('Sales by Hour of Day')
plt.xlabel('Hour')
plt.ylabel('Total Sales')
plt.xticks(range(0, 24))
plt.show()

# 6. Order Size Distribution
sns.histplot(df['Quantity'], bins=50, kde=True, color='lightgreen')
plt.title('Distribution of Order Quantities')
plt.xlabel('Quantity')
plt.ylabel('Frequency')
plt.xlim(0, df['Quantity'].quantile(0.99))
plt.show()

# 7. Average Unit Price Over Time
unit_price_trend = df.resample('W-Mon', on='InvoiceDate')['UnitPrice'].mean().reset_index()
sns.lineplot(data=unit_price_trend, x='InvoiceDate', y='UnitPrice')
plt.title('Weekly Avg Unit Price Over Time')
plt.xlabel('Date')
plt.ylabel('Average Unit Price')
plt.show()

# 8. Number of Invoices per Customer
invoice_counts = df.groupby('CustomerID')['InvoiceNo'].nunique()
sns.histplot(invoice_counts, bins=30, color='coral')
plt.title('Number of Invoices per Customer')
plt.xlabel('Invoice Count')
plt.ylabel('Number of Customers')
plt.show()

# 9. Returns / Negative Sales Detection
if (df['Quantity'] < 0).any():
    neg_df = df[df['Quantity'] < 0]
    returns_by_product = neg_df.groupby('Description')['Quantity'].sum().sort_values().head(10)
    sns.barplot(y=returns_by_product.index, x=returns_by_product.values, palette='coolwarm')
    plt.title('Top 10 Returned Products')
    plt.xlabel('Quantity Returned')
    plt.ylabel('Product')
    plt.show()

# 10. Sales by Day of Week
df['DayOfWeek'] = df['InvoiceDate'].dt.day_name()
dow_sales = df.groupby('DayOfWeek')['TotalPrice'].sum().reindex(
    ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
).reset_index()
sns.barplot(data=dow_sales, x='DayOfWeek', y='TotalPrice', palette='pastel')
plt.title('Sales by Day of Week')
plt.xticks(rotation=45)
plt.ylabel('Total Sales')
plt.show()
            </code></pre>
        </div>
    </div>
</body>
</html>
